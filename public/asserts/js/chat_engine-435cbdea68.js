let self;class ChatEngine{constructor(e,s){if(this.chatBox=$(`#${e}`),this.userId=s,this.socket=io.connect("http://localhost:5000"),self=this,this.userId){let e=$(".connect-to");self.connectionHandler(),e.click(this,function(e){e.preventDefault();let s=$(this).attr("data-name");console.log(s),$("#curr-user-name").html(`${s}`);let t=$(this).attr("data-img");t||(t="https://www.kindpng.com/picc/m/78-786207_user-avatar-png-user-avatar-icon-png-transparent.png"),$("#curr-user-img").prop({src:t});let o=$(this).attr("data-id"),a=self.getKey(o,self.userId);console.log("key",a),self.chatroom&&(self.prevroom=self.chatroom),self.chatroom=a,self.handelJoinRoom()})}}getKey(e,s){let t=0,o=1;for(let a=0;a<e.length;a++){t+=(e.charCodeAt(a)+s.charCodeAt(a))*o,o*=2}return t}connectionHandler(){console.log("connection Handler called!");this.socket.on("connect",function(){console.log("connection established using sockets...!")})}handelJoinRoom(){self.prevroom&&self.socket.emit("leave_room",{user_id:self.userId,prevroom:self.prevroom}),self.socket.emit("join_room",{user_id:self.userId,chatroom:self.chatroom}),self.socket.on("user_joined",function(e){console.log("a user joined!",e)});let e=function(){let e=$("#chat-message-input").val();""!=e&&($("#chat-message-input").val(""),self.socket.emit("send_message",{message:e,user_id:self.userId,chatroom:self.chatroom}))};$("#send-message").click(e),$("#chat-message-input").keypress(function(s){13==s.which&&(s.preventDefault(),e())}),self.socket.on("receive_message",function(e){console.log("message received",e);let s=$("<li>"),t="friend-message";e.user._id==self.userId&&(t="user-message");let o=$("<div>").addClass("mssg-info-container");s.append(o),o.append($("<p>",{html:e.message}));let a=e.user.avatar;e.user.avatar||(a="https://www.kindpng.com/picc/m/78-786207_user-avatar-png-user-avatar-icon-png-transparent.png"),"user-message"==t?o.append($("<img>",{src:a})):o.prepend($("<img>",{src:a})),s.addClass(t),$("#chat-message-list").append(s),$("#chat-interface").animate({scrollTop:$("#chat-message-list").height()},0)})}}